name: Pre-Commit Checks

on:
  pull_request:
    branches: [ main, dev ]
    paths:
      - 'Pettio.IOS/**/*.swift'
      - '.github/workflows/**'
  workflow_dispatch:

jobs:
  swift-format-check:
    name: Swift Format Check
    runs-on: macos-14
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Check minimum line coverage
        run: |
          echo "üìä Checking Test Report..."
          
          # This is a placeholder for actual coverage reports
          # In future, integrate with coverage tools like Codecov
          echo "‚ÑπÔ∏è  Test coverage tracking ready for integration"
      
      - name: Validate models
        run: |
          echo "üîç Validating SwiftData Models:"
          echo "================================"
          
          # Check that all models have @Model decorator
          MODELS=$(find Pettio.IOS/Models -name "*.swift" -type f 2>/dev/null)
          
          if [ -z "$MODELS" ]; then
            echo "‚ö†Ô∏è  No models found in Pettio.IOS/Models"
            exit 0
          fi
          
          for model in $MODELS; do
            if grep -q "@Model" "$model"; then
              echo "‚úÖ $(basename $model): Has @Model decorator"
            else
              echo "‚ùå $(basename $model): Missing @Model decorator"
              exit 1
            fi
          done
      
      - name: Validate view models
        run: |
          echo "üîç Validating ViewModels:"
          echo "=========================="
          
          # Check that all view models have @Observable decorator
          VIEWMODELS=$(find Pettio.IOS/ViewModels -name "*.swift" -type f 2>/dev/null)
          
          if [ -z "$VIEWMODELS" ]; then
            echo "‚ö†Ô∏è  No ViewModels found in Pettio.IOS/ViewModels"
            exit 0
          fi
          
          for viewmodel in $VIEWMODELS; do
            if grep -q "@Observable\|@StateObject\|@EnvironmentObject" "$viewmodel"; then
              echo "‚úÖ $(basename $viewmodel): Has state management decorator"
            else
              echo "‚ö†Ô∏è  $(basename $viewmodel): Consider adding state management"
            fi
          done

